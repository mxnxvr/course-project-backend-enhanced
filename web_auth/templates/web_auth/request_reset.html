{% extends 'web_auth/base.html' %}

{% block title %}Reset Password{% endblock %}

{% block content %}
<h1>Reset Password</h1>
<p>Enter your email address and we'll send you a link to reset your password.</p>

<form id="reset-request-form">
    <div class="input-group">
        <label for="email">Email Address</label>
        <input type="email" id="email" name="email" required placeholder="name@example.com">
    </div>
    <button type="submit" id="submit-btn">Send Reset Link</button>
</form>

<div id="status" class="status-message"></div>
{% endblock %}

{% block scripts %}
<script>
    const form = document.getElementById('reset-request-form');
    const status = document.getElementById('status');
    const btn = document.getElementById('submit-btn');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        btn.disabled = true;
        btn.textContent = "Sending...";
        status.className = 'status-message';
        status.style.display = 'none';

        const email = document.getElementById('email').value;

        try {
            const response = await fetch('/api/password-reset-request/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email })
            });

            const data = await response.json();

            if (response.ok) {
                status.textContent = "If an account exists with that email, we have sent a password reset link.";
                status.classList.add('success');
                form.reset();
            } else {
                status.textContent = data.error || "Something went wrong.";
                status.classList.add('error');
            }
        } catch (error) {
            status.textContent = "Network error. Please try again.";
            status.classList.add('error');
        } finally {
            btn.disabled = false;
            btn.textContent = "Send Reset Link";
        }
    });
</script>
{% endblock %}